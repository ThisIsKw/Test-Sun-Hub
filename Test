local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Window = Fluent:CreateWindow({
    Title = "Sun Hub",
    SubTitle = "by NovaTeam",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = {
    Combat = Window:AddTab({ Title = "Combat", Icon = "crosshair" }),
    Player = Window:AddTab({ Title = "Player", Icon = "user" }),
    Teleport = Window:AddTab({ Title = "Teleport", Icon = "map-pin" }),
    AutoFarm = Window:AddTab({ Title = "Auto Farm", Icon = "gamepad-2" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

local Options = Fluent.Options

-- Combat/Silent Aim Variables
local combatConfig = {
    showButton = false,
    draggableButton = false,
    holsterWeapon = false,
    bulletSpeed = 500,
    gravity = 196.2
}

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local screenButton = nil

-- Player Script Variables
local player = game.Players.LocalPlayer
local rs = game:GetService("RunService")
local MY_SPEED = 16 
local MY_JUMP = 50 
local loopConnection = nil
local scriptActive = false

-- Combat Functions
local function EquipWeapon()
    local char = LocalPlayer.Character
    if not char then return false end
    
    local gun = LocalPlayer.Backpack:FindFirstChild("Gun")
    if gun then
        local humanoid = char:FindFirstChild("Humanoid")
        if humanoid then
            humanoid:EquipTool(gun)
            task.wait(0.05)
            return true
        end
    end
    return false
end

local function HolsterWeapon()
    local char = LocalPlayer.Character
    if not char then return end
    
    local humanoid = char:FindFirstChild("Humanoid")
    if humanoid then
        humanoid:UnequipTools()
    end
end

local function FindMurder()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local hrp = player.Character:FindFirstChild("HumanoidRootPart")
            if hrp and (player.Character:FindFirstChild("Knife") or player.Backpack:FindFirstChild("Knife")) then
                return hrp
            end
        end
    end
    return nil
end

local function ExecuteSilentAim()
    local char = LocalPlayer.Character
    local gun = char and char:FindFirstChild("Gun")
    
    if not gun then
        if not EquipWeapon() then return end
        gun = char:FindFirstChild("Gun")
    end
    
    local target = FindMurder()
    local event = gun and gun:FindFirstChild("Shoot")
    
    if not (target and event) then return end
    
    local targetVel = target.Velocity
    local targetPos = target.Position
    local myPos = char.Head.Position
    local distance = (targetPos - myPos).Magnitude
    local travelTime = distance / combatConfig.bulletSpeed
    
    local prediction = targetPos + (targetVel * travelTime)
    prediction = prediction + Vector3.new(0, -0.5 * combatConfig.gravity * (travelTime ^ 2), 0)
    
    event:FireServer(CFrame.new(myPos, prediction), CFrame.new(prediction))
    
    if combatConfig.holsterWeapon then
        task.wait(0.03)
        HolsterWeapon()
    end
end

local function CreateScreenButton()
    if screenButton then return end
    
    local sg = Instance.new("ScreenGui")
    sg.Name = "SilentAimButton"
    sg.ResetOnSpawn = false
    sg.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    local btn = Instance.new("TextButton")
    btn.Name = "ShootButton"
    btn.Size = UDim2.new(0, 80, 0, 80)
    btn.Position = UDim2.new(0.85, 0, 0.5, 0)
    btn.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    btn.Text = "ðŸŽ¯"
    btn.TextSize = 35
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamBold
    btn.Parent = sg
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 15)
    corner.Parent = btn
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(0, 0, 0)
    stroke.Thickness = 3
    stroke.Parent = btn
    
    btn.MouseButton1Click:Connect(ExecuteSilentAim)
    
    local dragging, dragInput, mousePos, framePos = false, nil, nil, nil
    
    btn.InputBegan:Connect(function(input)
        if combatConfig.draggableButton and (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
            dragging = true
            mousePos = input.Position
            framePos = btn.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    btn.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - mousePos
            btn.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X, framePos.Y.Scale, framePos.Y.Offset + delta.Y)
        end
    end)
    
    sg.Parent = game:GetService("CoreGui")
    screenButton = sg
end

local function RemoveScreenButton()
    if screenButton then
        screenButton:Destroy()
        screenButton = nil
    end
end

-- Player Functions
local function maintainStats()
    local char = player.Character
    local humanoid = char and char:FindFirstChild("Humanoid")
    
    if humanoid then
        if humanoid.WalkSpeed ~= MY_SPEED then
            humanoid.WalkSpeed = MY_SPEED
        end
        
        humanoid.UseJumpPower = true
        if humanoid.JumpPower ~= MY_JUMP then
            humanoid.JumpPower = MY_JUMP
        end
    end
end

local function activateLoop()
    if loopConnection then loopConnection:Disconnect() end
    loopConnection = rs.Heartbeat:Connect(maintainStats)
end

local function deactivateLoop()
    if loopConnection then 
        loopConnection:Disconnect() 
        loopConnection = nil
    end
end

player.CharacterAdded:Connect(function()
    if scriptActive then
        activateLoop()
    end
end)

do
    -- Initial welcome notification
    Fluent:Notify({
        Title = "Sun Hub",
        Content = "Welcome to Sun Hub!",
        SubContent = "Script loaded successfully",
        Duration = 5
    })
    
    -- Combat Tab
    Tabs.Combat:AddParagraph({
        Title = "Silent Aim",
        Content = "The script automatically equips the weapon. Use the screen button or configured key to shoot the Murderer with precision."
    })
    
    Tabs.Combat:AddToggle("ToggleButton", {
        Title = "Show Screen Button",
        Default = false,
        Callback = function(v)
            combatConfig.showButton = v
            if v then 
                CreateScreenButton()
            else 
                RemoveScreenButton()
            end
        end
    })
    
    Tabs.Combat:AddToggle("ToggleDrag", {
        Title = "Allow Dragging Button",
        Default = false,
        Callback = function(v)
            combatConfig.draggableButton = v
        end
    })
    
    Tabs.Combat:AddToggle("ToggleHolster", {
        Title = "Holster Weapon After Shooting",
        Default = false,
        Callback = function(v)
            combatConfig.holsterWeapon = v
        end
    })
    
    Tabs.Combat:AddKeybind("SilentKeybind", {
        Title = "Hotkey",
        Mode = "Toggle",
        Default = "Q",
        Callback = ExecuteSilentAim
    })
    
    local BulletSpeedSlider = Tabs.Combat:AddSlider("BulletSpeed", {
        Title = "Bullet Speed",
        Description = "Adjust speed for better accuracy",
        Default = 500,
        Min = 100,
        Max = 1000,
        Rounding = 0,
        Callback = function(Value)
            combatConfig.bulletSpeed = Value
        end
    })
    
    local GravitySlider = Tabs.Combat:AddSlider("Gravity", {
        Title = "Gravity",
        Description = "Adjust gravity compensation",
        Default = 196.2,
        Min = 0,
        Max = 400,
        Rounding = 1,
        Callback = function(Value)
            combatConfig.gravity = Value
        end
    })
    
    -- Player Tab
    Tabs.Player:AddParagraph({
        Title = "Movement Settings",
        Content = "Customize your character's movement speed and jump power."
    })
    
    local WalkSpeedSlider = Tabs.Player:AddSlider("WalkSpeed", {
        Title = "Walk Speed",
        Description = "Adjust your walking speed",
        Default = 16,
        Min = 16,
        Max = 200,
        Rounding = 0,
        Callback = function(Value)
            MY_SPEED = Value
        end
    })
    
    local JumpPowerSlider = Tabs.Player:AddSlider("JumpPower", {
        Title = "Jump Power",
        Description = "Adjust your jump power",
        Default = 50,
        Min = 50,
        Max = 300,
        Rounding = 0,
        Callback = function(Value)
            MY_JUMP = Value
        end
    })
    
    local ToggleMovement = Tabs.Player:AddToggle("ToggleMovement", {
        Title = "Enable Movement Modifier",
        Default = false
    })
    
    ToggleMovement:OnChanged(function()
        scriptActive = Options.ToggleMovement.Value
        if scriptActive then
            activateLoop()
        else
            deactivateLoop()
        end
    end)
    
    -- Teleport Tab
    Tabs.Teleport:AddParagraph({
        Title = "Teleport Options",
        Content = "Quick teleport to different locations and players in MM2."
    })
    
    Tabs.Teleport:AddButton({
        Title = "Teleport to Lobby",
        Description = "Teleport back to the lobby/spawn area",
        Callback = function()
            local TARGET_POS = Vector3.new(14.27564525604248, 504.818115234375, -45.334800720214844)
            local character = LocalPlayer.Character
            local root = character and character:FindFirstChild("HumanoidRootPart")
            
            if root then
                root.Velocity = Vector3.new(0, 0, 0)
                root.CFrame = CFrame.new(TARGET_POS + Vector3.new(0, 3, 0))
            else
                Fluent:Notify({
                    Title = "Teleport",
                    Content = "Character not found!",
                    Duration = 3
                })
            end
        end
    })
    
    Tabs.Teleport:AddButton({
        Title = "Teleport to Murder",
        Description = "Teleport to the murderer",
        Callback = function()
            local target = nil
            for _, p in pairs(Players:GetPlayers()) do
                if p ~= LocalPlayer and p.Character then
                    if p.Character:FindFirstChild("Knife") or p.Backpack:FindFirstChild("Knife") then
                        target = p.Character:FindFirstChild("HumanoidRootPart")
                        break
                    end
                end
            end

            local myRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if myRoot and target then
                myRoot.CFrame = target.CFrame * CFrame.new(0, 0, 3)
            else
                Fluent:Notify({
                    Title = "Teleport",
                    Content = "Murder not found!",
                    Duration = 3
                })
            end
        end
    })
    
    Tabs.Teleport:AddButton({
        Title = "Teleport to Sheriff",
        Description = "Teleport to the sheriff",
        Callback = function()
            local target = nil
            for _, p in pairs(Players:GetPlayers()) do
                if p ~= LocalPlayer and p.Character then
                    if p.Character:FindFirstChild("Gun") or p.Backpack:FindFirstChild("Gun") then
                        target = p.Character:FindFirstChild("HumanoidRootPart")
                        break
                    end
                end
            end

            local myRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if myRoot and target then
                myRoot.CFrame = target.CFrame * CFrame.new(0, 0, 3)
            else
                Fluent:Notify({
                    Title = "Teleport",
                    Content = "Sheriff not found!",
                    Duration = 3
                })
            end
        end
    })
    
    local playersList = {}
    local function RefreshPlayers()
        playersList = {}
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                table.insert(playersList, player.Name)
            end
        end
        return playersList
    end
    
    RefreshPlayers()
    
    local PlayerDropdown = Tabs.Teleport:AddDropdown("PlayerDropdown", {
        Title = "Select Player",
        Values = playersList,
        Multi = false,
        Default = 1,
    })
    
    Tabs.Teleport:AddButton({
        Title = "Refresh Players",
        Description = "Update the player list",
        Callback = function()
            local newList = RefreshPlayers()
            PlayerDropdown:SetValues(newList)
        end
    })
    
    Tabs.Teleport:AddButton({
        Title = "Teleport to Selected Player",
        Description = "Teleport to the selected player",
        Callback = function()
            local selectedPlayer = Options.PlayerDropdown.Value
            if selectedPlayer then
                local targetPlayer = Players:FindFirstChild(selectedPlayer)
                
                if targetPlayer and targetPlayer.Character then
                    local myRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                    local targetRoot = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
                    
                    if myRoot and targetRoot then
                        myRoot.CFrame = targetRoot.CFrame * CFrame.new(0, 0, 3)
                    end
                end
            else
                Fluent:Notify({
                    Title = "Teleport",
                    Content = "Please select a player first!",
                    Duration = 3
                })
            end
        end
    })
    
    -- Auto Farm Tab
    Tabs.AutoFarm:AddParagraph({
        Title = "Auto Farm Settings",
        Content = "Anti-AFK system to keep you active in the game."
    })
    
    local antiAFKActive = false
    local antiAFKConnection = nil
    
    local ToggleAntiAFK = Tabs.AutoFarm:AddToggle("ToggleAntiAFK", {
        Title = "Anti-AFK",
        Default = false
    })
    
    ToggleAntiAFK:OnChanged(function()
        antiAFKActive = Options.ToggleAntiAFK.Value
        
        if antiAFKActive then
            local VU = game:GetService("VirtualUser")
            
            antiAFKConnection = LocalPlayer.Idled:Connect(function()
                VU:CaptureController()
                VU:ClickButton2(Vector2.new())
            end)
        else
            if antiAFKConnection then
                antiAFKConnection:Disconnect()
                antiAFKConnection = nil
            end
        end
    end)
end

SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)

SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})

InterfaceManager:SetFolder("FluentScriptHub")
SaveManager:SetFolder("FluentScriptHub/specific-game")

InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)

Window:SelectTab(1)

Fluent:Notify({
    Title = "Sun Hub",
    Content = "Script loaded and ready to use!",
    Duration = 8
})

SaveManager:LoadAutoloadConfig()
